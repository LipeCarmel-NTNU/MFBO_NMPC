\documentclass[a4paper,11pt]{article}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{listings}

\lstset{
	basicstyle=\ttfamily\small,
	frame=single,
	breaklines=true,
	numbers=left,
	numberstyle=\tiny
}

\begin{document}
	
	\section*{Definition of the tuning vector $\theta$}
	
	The NMPC configuration is parametrized by the column vector
	\[
	\theta^\top =
	\big[
	f,\;
	\theta_p,\;
	\theta_m,\;
	q,\;
	r^{(u)},\;
	r^{(\Delta u)}
	\big].
	\]
	
	The components satisfy:
	\begin{align*}
		f &\in (0, 1), \\
		\theta_m &\in \mathbb{Z}_{\ge 0}, \qquad 0 \leq \theta_m \leq 30, \\
		\theta_p &\in \mathbb{Z}_{\ge 0}, \qquad 0 \leq \theta_p \leq 60, \\
		q &\in [-3,3]^3, \\
		r^{(u)} &\in [-3,3]^3, \\
		r^{(\Delta u)} &\in [-3,3]^3.
	\end{align*}
	
	The weighting matrices are given by
	\[
	Q = \mathrm{diag}(10^{q}), \quad
	R_u = \mathrm{diag}(10^{r^{(u)}}), \quad
	R_{\Delta u} = \mathrm{diag}(10^{r^{(\Delta u)}}).
	\]
	
	The horizons are
	\begin{align*}
		m &= \theta_m + 1, \\
		p &= \theta_p + m.
	\end{align*}
	
	\section*{Surrogate for time}
	
	\subsection*{Implementation}
	
	\begin{lstlisting}[language=Matlab]
		function t_hat = time_model(x, m, p, alfa, beta, a)
		k = 20;
		softplus = @(z) log1p(exp(k*z)) / k;
		
		y = a(1) + a(2)*x;
		t_base = y + softplus(-y);
		
		scale = (m/10).^alfa .* (p/30).^beta;
		t_hat = scale .* t_base;
		end
	\end{lstlisting}
	
	\subsection*{Mathematical form}
	
	Let the scalar input be normalised to the interval $[-1,1]$ as
	\[
	x = 2f - 1.
	\]
	
	The shape term is modelled as an affine function of $x$,
	\[
	y(x) = a_0 + a_1 x.
	\]
	
	Define the smooth rectifier
	\[
	\operatorname{softplus}_k(z)
	=
	\frac{1}{k}\log\!\left(1 + e^{k z}\right),
	\quad k > 0.
	\]
	
	The base time surrogate is
	\[
	t_{\mathrm{base}}(x)
	=
	y(x) + \operatorname{softplus}_{k=20}\!\left(-y(x)\right),
	\]
	which enforces non-negativity while remaining continuously differentiable.
	
	The full surrogate for the computation time \textbf{in hours} is
	\[
	\hat{t}(x,m,p)
	=
	\left(\frac{m}{10}\right)^{\alpha}
	\left(\frac{p}{30}\right)^{\beta}
	\, t_{\mathrm{base}}(x).
	\]
	
	Fitting is performed in hours to avoid numerical scaling issues during optimisation.
	
	\subsection*{Fitted parameters}
	
	\begin{table}[h]
		\centering
		\caption{Estimated parameters of the surrogate time model.}
		\begin{tabular}{lll}
			\hline
			Category & Parameter & Value \\
			\hline
			Scaling exponents
			& $\alpha$ & $0.33233435$ \\
			& $\beta$  & $2.3029582$ \\
			\hline
			Affine shape coefficients
			& $a_0$ & $8.843454 \times 10^{-1}$ \\
			& $a_1$ & $1.079230$ \\
			\hline
			Softplus parameter
			& $k$ & $20$ \\
			\hline
			Fit quality
			& $R^2$ & $0.999417$ \\
			\hline
		\end{tabular}
	\end{table}
	
\end{document}
